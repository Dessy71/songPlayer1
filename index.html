<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Slide navbar</title>
  
  <script src="https://code.jquery.com/jquery-3.6.4.min.js"
  integrity="sha256-oP6HI9z1XaZNBrJURtCoUT5SUnxFr8s3BzRl+cbzUq8=" crossorigin="anonymous"></script>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js" type="module"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js" type="module"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


  <link rel="stylesheet" type="text/css" href="slidestyles.css">
</head>
<body>

  <div class="video-background">
    <video autoplay loop muted>
      <source src="vid.mp4" type="video/mp4">
      Your browser does not support the video tag.
    </video>
  </div>
 <div class="logo-container">
    <img src="indLogo.svg" alt="Logo">
  </div>
  <div class="main">
    <input type="checkbox" id="chk" aria-hidden="true">
    <div class="login">
      <form id="loginForm">
        <label for="chk" aria-hidden="true">Login</label>
        <input type="text" placeholder="Username" id="loginUsername" required>
        <input type="password" placeholder="Password" id="loginPassword" required>
        <button type="submit">Login</button>
      </form>
    </div>
    <div class="signup">
      <form id="signupForm">
        <label for="chk" aria-hidden="true">Sign Up</label>
        <input type="text" placeholder="Username" id="signupUsername" required>
        <input type="email" placeholder="Email" id="signupEmail" required>
        <input type="password" placeholder="Password" id="signupPassword" required>
        <button type="submit">Sign Up</button>
      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
  crossorigin="anonymous"></script>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, get, child, set } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    // Initialize Firebase app
    const firebaseConfig = {
  apiKey: "AIzaSyClM1v69pjRX9b7EZ5lVMFpi_1ScV41s6w",
  authDomain: "gyidi-music-ebaf3.firebaseapp.com",
  databaseURL: "https://gyidi-music-ebaf3-default-rtdb.firebaseio.com",
  projectId: "gyidi-music-ebaf3",
  storageBucket: "gyidi-music-ebaf3.appspot.com",
  messagingSenderId: "510934356254",
  appId: "1:510934356254:web:529827e376123f1fba390f"
};
    const app = initializeApp(firebaseConfig);
const db = getDatabase(app); // Passing the app instance to getDatabase()

  // Function to handle user registration
  document.getElementById("signupForm").addEventListener("submit", function(event) {
    event.preventDefault();
    const username = document.getElementById("signupUsername").value;
    const email = document.getElementById("signupEmail").value;
    const password = document.getElementById("signupPassword").value;

    // Validation
    if (username.trim() === "" || email.trim() === "" || password.trim() === "") {
      return Swal.fire("Error", "All fields are required.", "error");
    }

    // Check if the username already exists
    get(child(ref(db, "users"), username)).then(snapshot => {
      if (snapshot.exists()) {
        // Username already exists, display error message
        Swal.fire("Error", "Username already exists. Please choose a different username.", "error");
      } else {
        // Username is available, register user in Firebase database
        set(ref(db, "users/" + username), {
          email: email,
          password: CryptoJS.AES.encrypt(password, password).toString() // Encrypting password
        }).then(() => {
          Swal.fire("Success", "User registered successfully.", "success");
          document.getElementById("signupForm").reset();
        }).catch(error => {
          Swal.fire("Error", error.message, "error");
        });
      }
    }).catch(error => {
      Swal.fire("Error", error.message, "error");
    });
  });
// Function to handle user login
document.getElementById("loginForm").addEventListener("submit", function(event) {
  event.preventDefault();
  const username = document.getElementById("loginUsername").value;
  const password = document.getElementById("loginPassword").value;

  get(child(ref(db, "users"), username)).then(snapshot => {
    if (snapshot.exists()) {
      const decryptedPassword = CryptoJS.AES.decrypt(snapshot.val().password, password).toString(CryptoJS.enc.Utf8);
      if (decryptedPassword === password) {
        // Login successful
        Swal.fire("Success", "Login successful.", "success");
        // Redirect to home page
        window.location.href = "home.html";
      } else {
        Swal.fire("Error", "Invalid password.", "error");
      }
    } else {
      Swal.fire("Error", "User not found.", "error");
    }
  }).catch(error => {
    Swal.fire("Error", error.message, "error");
  });
});
  </script>
</body>
</html>
